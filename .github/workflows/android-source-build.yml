name: Android Source Build
on: [push]
jobs:
    build:
        container: ubuntu:14.04
        steps:
            - run: apt-get update && apt-get install -y git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libgl1-mesa-dev libxml2-utils xsltproc unzip python openjdk-7-jdk
            - run: curl -o /usr/local/bin/repo https://storage.googleapis.com/git-repo-downloads/repo
            - run: echo "d06f33115aea44e583c8669375b35aad397176a411de3461897444d247b6c220  /usr/local/bin/repo" | sha256sum --strict -c -
            - run: chmod a+x /usr/local/bin/repo
            - name: Create and access working directory
              run: |
                mkdir minTWRPOmni51
                cd minTWRPOmni51
            - run: repo init -u git://github.com/minimal-manifest-twrp/platform_manifest_twrp_omni.git -b twrp-5.1
            - run: repo sync -c -j4
            - run: mkdir -p minTWRPOmni51/device/onda/v80se
            - name: Clone repository to its device folder
              uses: actions/checkout@v2
              with:
                path: minTWRPOmni51/device/onda/v80se
            - run: . build/envsetup.sh
            - run: lunch omni_v80se-eng
            - run: mka recoveryimage
            - name: Upload recovery image
              uses: actions/upload-artifact@v2
              with:
                path: minTWRPOmni51/out/target/product/v80se/recovery.img
            
