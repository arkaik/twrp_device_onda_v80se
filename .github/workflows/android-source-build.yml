name: Android Source Build
on: [push]
jobs:
    build:
        runs-on: ubuntu-latest
        container: ubuntu:14.04
        steps:
            - name: Update package repositories
              run: apt-get update -qq
            - name: Install dependencies
              run: apt-get install -y git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libgl1-mesa-dev libxml2-utils xsltproc unzip python openjdk-7-jdk
            - name: Install 'repo'
              run: |
                curl -o /usr/local/bin/repo https://storage.googleapis.com/git-repo-downloads/repo-1
                chmod a+x /usr/local/bin/repo
            - name: Create and access working directory
              run: |
                mkdir minTWRPOmni51
                cd minTWRPOmni51
            - run: repo init --depth=1 -u git://github.com/minimal-manifest-twrp/platform_manifest_twrp_omni.git -b twrp-5.1
            - name: Sincronizamos el repositorio con los metadatos seleccionados
              run: repo sync -c -j$(nproc --all)
            - run: mkdir -p minTWRPOmni51/device/onda
            - name: Clone repository to its device folder
              uses: actions/checkout@v2
              with:
                name: v80se
                path: minTWRPOmni51/device/onda
            - run: source build/envsetup.sh
            - run: lunch omni_v80se-eng
            - run: mka recoveryimage
            - name: Upload recovery image
              uses: actions/upload-artifact@v2
              with:
                path: minTWRPOmni51/out/target/product/v80se/recovery.img
            
